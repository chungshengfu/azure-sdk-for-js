/*
 * Copyright (c) Microsoft Corporation.
 * Licensed under the MIT License.
 *
 * Code generated by Microsoft (R) AutoRest Code Generator.
 * Changes may cause incorrect behavior and will be lost if the code is regenerated.
 */

import * as coreClient from "@azure/core-client";
import * as coreRestPipeline from "@azure/core-rest-pipeline";
import {
  PipelineRequest,
  PipelineResponse,
  SendRequest
} from "@azure/core-rest-pipeline";
import * as coreAuth from "@azure/core-auth";
import {
  NodeCountInformationImpl,
  SoftwareUpdateConfigurationsImpl,
  DeletedAutomationAccountsImpl,
  PrivateLinkResourcesImpl,
  AgentRegistrationInformationImpl,
  DscNodeOperationsImpl,
  NodeReportsImpl,
  AutomationAccountOperationsImpl,
  StatisticsOperationsImpl,
  UsagesImpl,
  KeysImpl,
  CertificateOperationsImpl,
  ConnectionOperationsImpl,
  ConnectionTypeOperationsImpl,
  CredentialOperationsImpl,
  DscCompilationJobOperationsImpl,
  DscCompilationJobStreamImpl,
  DscConfigurationOperationsImpl,
  DscNodeConfigurationOperationsImpl,
  HybridRunbookWorkersImpl,
  HybridRunbookWorkerGroupOperationsImpl,
  JobOperationsImpl,
  JobStreamOperationsImpl,
  JobScheduleOperationsImpl,
  LinkedWorkspaceOperationsImpl,
  ActivityOperationsImpl,
  ModuleOperationsImpl,
  ObjectDataTypesImpl,
  FieldsImpl,
  OperationsImpl,
  PackageOperationsImpl,
  PackagesImpl,
  PrivateEndpointConnectionsImpl,
  Python2PackageImpl,
  Python3PackageImpl,
  RunbookDraftOperationsImpl,
  RunbookOperationsImpl,
  TestJobStreamsImpl,
  TestJobOperationsImpl,
  RuntimeEnvironmentsImpl,
  ScheduleOperationsImpl,
  SoftwareUpdateConfigurationMachineRunsImpl,
  SoftwareUpdateConfigurationRunsImpl,
  SourceControlOperationsImpl,
  SourceControlSyncJobOperationsImpl,
  SourceControlSyncJobStreamsImpl,
  VariableOperationsImpl,
  WatcherOperationsImpl,
  WebhookOperationsImpl
} from "./operations";
import {
  NodeCountInformation,
  SoftwareUpdateConfigurations,
  DeletedAutomationAccounts,
  PrivateLinkResources,
  AgentRegistrationInformation,
  DscNodeOperations,
  NodeReports,
  AutomationAccountOperations,
  StatisticsOperations,
  Usages,
  Keys,
  CertificateOperations,
  ConnectionOperations,
  ConnectionTypeOperations,
  CredentialOperations,
  DscCompilationJobOperations,
  DscCompilationJobStream,
  DscConfigurationOperations,
  DscNodeConfigurationOperations,
  HybridRunbookWorkers,
  HybridRunbookWorkerGroupOperations,
  JobOperations,
  JobStreamOperations,
  JobScheduleOperations,
  LinkedWorkspaceOperations,
  ActivityOperations,
  ModuleOperations,
  ObjectDataTypes,
  Fields,
  Operations,
  PackageOperations,
  Packages,
  PrivateEndpointConnections,
  Python2Package,
  Python3Package,
  RunbookDraftOperations,
  RunbookOperations,
  TestJobStreams,
  TestJobOperations,
  RuntimeEnvironments,
  ScheduleOperations,
  SoftwareUpdateConfigurationMachineRuns,
  SoftwareUpdateConfigurationRuns,
  SourceControlOperations,
  SourceControlSyncJobOperations,
  SourceControlSyncJobStreams,
  VariableOperations,
  WatcherOperations,
  WebhookOperations
} from "./operationsInterfaces";
import * as Parameters from "./models/parameters";
import * as Mappers from "./models/mappers";
import {
  AutomationClientOptionalParams,
  GraphicalRunbookContent,
  ConvertGraphRunbookContentOptionalParams,
  ConvertGraphRunbookContentResponse
} from "./models";

export class AutomationClient extends coreClient.ServiceClient {
  $host: string;
  subscriptionId: string;
  apiVersion: string;

  /**
   * Initializes a new instance of the AutomationClient class.
   * @param credentials Subscription credentials which uniquely identify client subscription.
   * @param subscriptionId Gets subscription credentials which uniquely identify Microsoft Azure
   *                       subscription. The subscription ID forms part of the URI for every service call.
   * @param options The parameter options
   */
  constructor(
    credentials: coreAuth.TokenCredential,
    subscriptionId: string,
    options?: AutomationClientOptionalParams
  ) {
    if (credentials === undefined) {
      throw new Error("'credentials' cannot be null");
    }
    if (subscriptionId === undefined) {
      throw new Error("'subscriptionId' cannot be null");
    }

    // Initializing default values for options
    if (!options) {
      options = {};
    }
    const defaults: AutomationClientOptionalParams = {
      requestContentType: "application/json; charset=utf-8",
      credential: credentials
    };

    const packageDetails = `azsdk-js-arm-automation/11.0.0-beta.5`;
    const userAgentPrefix =
      options.userAgentOptions && options.userAgentOptions.userAgentPrefix
        ? `${options.userAgentOptions.userAgentPrefix} ${packageDetails}`
        : `${packageDetails}`;

    const optionsWithDefaults = {
      ...defaults,
      ...options,
      userAgentOptions: {
        userAgentPrefix
      },
      endpoint:
        options.endpoint ?? options.baseUri ?? "https://management.azure.com"
    };
    super(optionsWithDefaults);

    let bearerTokenAuthenticationPolicyFound: boolean = false;
    if (options?.pipeline && options.pipeline.getOrderedPolicies().length > 0) {
      const pipelinePolicies: coreRestPipeline.PipelinePolicy[] = options.pipeline.getOrderedPolicies();
      bearerTokenAuthenticationPolicyFound = pipelinePolicies.some(
        (pipelinePolicy) =>
          pipelinePolicy.name ===
          coreRestPipeline.bearerTokenAuthenticationPolicyName
      );
    }
    if (
      !options ||
      !options.pipeline ||
      options.pipeline.getOrderedPolicies().length == 0 ||
      !bearerTokenAuthenticationPolicyFound
    ) {
      this.pipeline.removePolicy({
        name: coreRestPipeline.bearerTokenAuthenticationPolicyName
      });
      this.pipeline.addPolicy(
        coreRestPipeline.bearerTokenAuthenticationPolicy({
          credential: credentials,
          scopes:
            optionsWithDefaults.credentialScopes ??
            `${optionsWithDefaults.endpoint}/.default`,
          challengeCallbacks: {
            authorizeRequestOnChallenge:
              coreClient.authorizeRequestOnClaimChallenge
          }
        })
      );
    }
    // Parameter assignments
    this.subscriptionId = subscriptionId;

    // Assigning values to Constant parameters
    this.$host = options.$host || "https://management.azure.com";
    this.apiVersion = options.apiVersion || "2023-05-15-preview";
    this.nodeCountInformation = new NodeCountInformationImpl(this);
    this.softwareUpdateConfigurations = new SoftwareUpdateConfigurationsImpl(
      this
    );
    this.deletedAutomationAccounts = new DeletedAutomationAccountsImpl(this);
    this.privateLinkResources = new PrivateLinkResourcesImpl(this);
    this.agentRegistrationInformation = new AgentRegistrationInformationImpl(
      this
    );
    this.dscNodeOperations = new DscNodeOperationsImpl(this);
    this.nodeReports = new NodeReportsImpl(this);
    this.automationAccountOperations = new AutomationAccountOperationsImpl(
      this
    );
    this.statisticsOperations = new StatisticsOperationsImpl(this);
    this.usages = new UsagesImpl(this);
    this.keys = new KeysImpl(this);
    this.certificateOperations = new CertificateOperationsImpl(this);
    this.connectionOperations = new ConnectionOperationsImpl(this);
    this.connectionTypeOperations = new ConnectionTypeOperationsImpl(this);
    this.credentialOperations = new CredentialOperationsImpl(this);
    this.dscCompilationJobOperations = new DscCompilationJobOperationsImpl(
      this
    );
    this.dscCompilationJobStream = new DscCompilationJobStreamImpl(this);
    this.dscConfigurationOperations = new DscConfigurationOperationsImpl(this);
    this.dscNodeConfigurationOperations = new DscNodeConfigurationOperationsImpl(
      this
    );
    this.hybridRunbookWorkers = new HybridRunbookWorkersImpl(this);
    this.hybridRunbookWorkerGroupOperations = new HybridRunbookWorkerGroupOperationsImpl(
      this
    );
    this.jobOperations = new JobOperationsImpl(this);
    this.jobStreamOperations = new JobStreamOperationsImpl(this);
    this.jobScheduleOperations = new JobScheduleOperationsImpl(this);
    this.linkedWorkspaceOperations = new LinkedWorkspaceOperationsImpl(this);
    this.activityOperations = new ActivityOperationsImpl(this);
    this.moduleOperations = new ModuleOperationsImpl(this);
    this.objectDataTypes = new ObjectDataTypesImpl(this);
    this.fields = new FieldsImpl(this);
    this.operations = new OperationsImpl(this);
    this.packageOperations = new PackageOperationsImpl(this);
    this.packages = new PackagesImpl(this);
    this.privateEndpointConnections = new PrivateEndpointConnectionsImpl(this);
    this.python2Package = new Python2PackageImpl(this);
    this.python3Package = new Python3PackageImpl(this);
    this.runbookDraftOperations = new RunbookDraftOperationsImpl(this);
    this.runbookOperations = new RunbookOperationsImpl(this);
    this.testJobStreams = new TestJobStreamsImpl(this);
    this.testJobOperations = new TestJobOperationsImpl(this);
    this.runtimeEnvironments = new RuntimeEnvironmentsImpl(this);
    this.scheduleOperations = new ScheduleOperationsImpl(this);
    this.softwareUpdateConfigurationMachineRuns = new SoftwareUpdateConfigurationMachineRunsImpl(
      this
    );
    this.softwareUpdateConfigurationRuns = new SoftwareUpdateConfigurationRunsImpl(
      this
    );
    this.sourceControlOperations = new SourceControlOperationsImpl(this);
    this.sourceControlSyncJobOperations = new SourceControlSyncJobOperationsImpl(
      this
    );
    this.sourceControlSyncJobStreams = new SourceControlSyncJobStreamsImpl(
      this
    );
    this.variableOperations = new VariableOperationsImpl(this);
    this.watcherOperations = new WatcherOperationsImpl(this);
    this.webhookOperations = new WebhookOperationsImpl(this);
    this.addCustomApiVersionPolicy(options.apiVersion);
  }

  /** A function that adds a policy that sets the api-version (or equivalent) to reflect the library version. */
  private addCustomApiVersionPolicy(apiVersion?: string) {
    if (!apiVersion) {
      return;
    }
    const apiVersionPolicy = {
      name: "CustomApiVersionPolicy",
      async sendRequest(
        request: PipelineRequest,
        next: SendRequest
      ): Promise<PipelineResponse> {
        const param = request.url.split("?");
        if (param.length > 1) {
          const newParams = param[1].split("&").map((item) => {
            if (item.indexOf("api-version") > -1) {
              return "api-version=" + apiVersion;
            } else {
              return item;
            }
          });
          request.url = param[0] + "?" + newParams.join("&");
        }
        return next(request);
      }
    };
    this.pipeline.addPolicy(apiVersionPolicy);
  }

  /**
   * Post operation to serialize or deserialize GraphRunbookContent
   * @param resourceGroupName Name of an Azure Resource group.
   * @param automationAccountName The name of the automation account.
   * @param parameters Input data describing the graphical runbook.
   * @param options The options parameters.
   */
  convertGraphRunbookContent(
    resourceGroupName: string,
    automationAccountName: string,
    parameters: GraphicalRunbookContent,
    options?: ConvertGraphRunbookContentOptionalParams
  ): Promise<ConvertGraphRunbookContentResponse> {
    return this.sendOperationRequest(
      { resourceGroupName, automationAccountName, parameters, options },
      convertGraphRunbookContentOperationSpec
    );
  }

  nodeCountInformation: NodeCountInformation;
  softwareUpdateConfigurations: SoftwareUpdateConfigurations;
  deletedAutomationAccounts: DeletedAutomationAccounts;
  privateLinkResources: PrivateLinkResources;
  agentRegistrationInformation: AgentRegistrationInformation;
  dscNodeOperations: DscNodeOperations;
  nodeReports: NodeReports;
  automationAccountOperations: AutomationAccountOperations;
  statisticsOperations: StatisticsOperations;
  usages: Usages;
  keys: Keys;
  certificateOperations: CertificateOperations;
  connectionOperations: ConnectionOperations;
  connectionTypeOperations: ConnectionTypeOperations;
  credentialOperations: CredentialOperations;
  dscCompilationJobOperations: DscCompilationJobOperations;
  dscCompilationJobStream: DscCompilationJobStream;
  dscConfigurationOperations: DscConfigurationOperations;
  dscNodeConfigurationOperations: DscNodeConfigurationOperations;
  hybridRunbookWorkers: HybridRunbookWorkers;
  hybridRunbookWorkerGroupOperations: HybridRunbookWorkerGroupOperations;
  jobOperations: JobOperations;
  jobStreamOperations: JobStreamOperations;
  jobScheduleOperations: JobScheduleOperations;
  linkedWorkspaceOperations: LinkedWorkspaceOperations;
  activityOperations: ActivityOperations;
  moduleOperations: ModuleOperations;
  objectDataTypes: ObjectDataTypes;
  fields: Fields;
  operations: Operations;
  packageOperations: PackageOperations;
  packages: Packages;
  privateEndpointConnections: PrivateEndpointConnections;
  python2Package: Python2Package;
  python3Package: Python3Package;
  runbookDraftOperations: RunbookDraftOperations;
  runbookOperations: RunbookOperations;
  testJobStreams: TestJobStreams;
  testJobOperations: TestJobOperations;
  runtimeEnvironments: RuntimeEnvironments;
  scheduleOperations: ScheduleOperations;
  softwareUpdateConfigurationMachineRuns: SoftwareUpdateConfigurationMachineRuns;
  softwareUpdateConfigurationRuns: SoftwareUpdateConfigurationRuns;
  sourceControlOperations: SourceControlOperations;
  sourceControlSyncJobOperations: SourceControlSyncJobOperations;
  sourceControlSyncJobStreams: SourceControlSyncJobStreams;
  variableOperations: VariableOperations;
  watcherOperations: WatcherOperations;
  webhookOperations: WebhookOperations;
}
// Operation Specifications
const serializer = coreClient.createSerializer(Mappers, /* isXml */ false);

const convertGraphRunbookContentOperationSpec: coreClient.OperationSpec = {
  path:
    "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Automation/automationAccounts/{automationAccountName}/convertGraphRunbookContent",
  httpMethod: "POST",
  responses: {
    200: {
      bodyMapper: Mappers.GraphicalRunbookContent
    },
    default: {
      bodyMapper: Mappers.ErrorResponse
    }
  },
  requestBody: Parameters.parameters21,
  queryParameters: [Parameters.apiVersion],
  urlParameters: [
    Parameters.$host,
    Parameters.resourceGroupName,
    Parameters.automationAccountName,
    Parameters.subscriptionId
  ],
  headerParameters: [Parameters.accept, Parameters.contentType],
  mediaType: "json",
  serializer
};
